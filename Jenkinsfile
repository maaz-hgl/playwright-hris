pipeline {
    agent any

    environment {
        # Non-sensitive
        BASE_URL = 'http://localhost:3000'
        SIGNUP_TITLE = 'Join Sync Dynamics Today'
        SIGNUP_FIRST_NAME = 'Maaz'
        SIGNUP_LAST_NAME = 'H'
        SIGNUP_PASS = 'StrongPass123!'
        SIGNUP_EMAIL_PREFIX = 'testuse'
        EXISTING_EMAIL = 'giri@admin.com'
        EMAIL_TO = 'sinchanaslnaidu1610@gmail.com'

        # Secret
        SECRET_KEY = '55c1009e51e6c852eea549f1bfa660311262853fef782a9c71555544ef1f69bc'

        # Encrypted sensitive info
        Login_Email_ENCRYPTED = '5d8d0fb0a7348bf4da8f30bc98d400b6:15dca6bda5ba9e610fbeff18bc954ffe'
        Login_Password_ENCRYPTED = '1b27dea003a27cd8fc22fb0820a4e5d3:ea49ca38aceeccbd05fb3abe8f206cb4'
        TEAMS_WEBHOOK_URL = 'e40bca2fabb3a6305a9250d49bd2fae5:de7ccd1f96763ad754659ce8aa518f8abcd8a459201442fabcd9bceef9185b7e0c1160b702e664a93274be2c5ca558f43357d42d8a76b608c9450841ea4572bd53ae07475a2b7577cf690b0d4c5544e5be1b699aa96812ab5e861c28c06a87d3f5e431a50afec3533129b4ea0f58e889b412d2bb9250b5a06e2797bc72f49f2ac6e90b47de395ac199f4ca397cc86f1256f1a10bb1a794fd584ee1ddbbacbe3aac96cab25e4a8ff4a6bce96f4931aff72479ec7e58131017d59abef94f43f9d1ceb59dc84b58d96a0dc5196e0cc11a10ef7ddb700a193a9fb11418548dd40743d60db318c83a1f86a1b03fa85d9d5c96d40aa7e3d8721e192f335d52c899c49e648dc1ea38405bb7e05b3d8b92b414fe'
        EMAIL_USER = '505a634e481b87947ed1a4c1ba43a08b:2ace5af2ae10388eca4b4c8c5a572314cd70655d9936cb0127ce756b250523e3'
        EMAIL_PASS = '2474e96ed2f6cac5fa882d53eb8ebdc8:9ddf970fcd0cceb5acd89b956f6135bf50bf0c95edbbcc6ee9c9bfd0df6410cd'
        GRAPH_ACCESS_TOKEN_ENCRYPTED = 'cf2d2e8026cc24f0ba094a1599bb3610:d9f73c2f37df0f6183a6e0490e84b311d141e8248d361f729e4ee2ff4c9a34e1f8955edd10c83b60ecbb55e9165f287c22e94f8626429357a8a525ff4876ff89c44db8a10f5d293109a0dd9c3c9aa58f8f50e470506cdd0780102d3d6cb81cfbddf1ecba53a7ee71203b8795e3eb1a014d32c4e08f69700ed8cfebe9d87002783661cbf145b67fbf058ecc992013fcfb2073f72b7bc0f52420dc40abbdc0025d93dc0c4c70d46299adb12b5496634a40ab7e8279c50c8f36843e08ea5293c116a214fca91cafdbc2cd6d0ec1612e1f17b6d6bae080c0321e3c03c446f03d369d5d3ecda92a347d06acb10f82b8ad8d16aa0aad7f1c1a6a63035d4973578d01ba232c81d38b77efc892fd45e4dc29088c9faff58fc6f95f22c9653a6fa9fa547b6aed742f84823d63cf7b986af2c19447446aaa58c0fab98a8b22725d8172b4dc5a43981bc2b68742e926902c96d87065a9fe419a7f71d7768d2519d5eee2744e4164f2e4f74be4d5447fd9f914fc5a334558b99bcedf226baff97c9e1688d6508c7f5c6aeaa4e4c0d6b2b2f339ae77f4ac98ed36c385646546c7cc7a32d7d53212f063df737b5d9788ba18dd879549d1de1ea099699e406815f3c3f0b4cb5e8a3165ded271053c1003603ba678e90a057636995fddeacd045bcfe499c4d30960cf9e374cf2d8debdb00605bd9582e1e95748c38c2d5aa811680c1e0768a357f947ad35418fc646c902ba6f7d3d5ef5502abae8264ba73a3788b4579152ff0d2879820e0429fa4cb3dc4ef92abe1545a1d1e86a7d77d7d6180adb69caa6636e4f6144d7bfbb6b75d6871da3ee5961059de6672033a482c6691fbf956347c5cf98e36c299e67388bcc0cfb8638f552ced5815e20300f4a409d299c65e19310fd2fe47a09c6917b7a77be6e9916800d11cb59435bf679be7728b53ec56ee04205cbf58b373b740690faf3a6ed6ed5692fa5ecfa17e06104e997c5c1cafe3e02743a4a5c219656aa4ecc0092936cf4959dcc362c22e1d0aad13b3b29ac70edcc46b4f720ebc119f9cd8beef777f161a7a3071a8a9833aadc8db73878af7e504badf9008977bc5c2a60e2c99f9d57eebb5dc91a7d724238db6c1be8328bba63819cc1fb36a8c122b4df90f4489e3a186470b11cf9dfc5a879b73047e39da7e8744b14e5b93f63d8913f6f3f60bb523aba83af5deb2469ad8ddba98ddde7fdac0d2107a64019400e9a8376c17527fda29e74cff56ef49030ae77024d96fff12b08ee1d5222eca9237c5ef6ee72527d25b3cbfc2428f31398197afc7ec30004e02a612ddcd5b93a882ef56b345e2d415ba90a05fe38bb436c01d6325bac84b48a235e205eb7034dd0857b6d8db4ab09809b5e2d5103a8c027fdae7f44f17eeab0dcddfef0ee061759facf8e1366a3f12ce0adca38009e3c7243155a2215762ff7ec309cf25d399b0979cdf47db5d18c5924b9d3665a4f65d69172bd2f71a9c6dd21c18d20003215469a242003bb9a5e1b50f101757c256b092ea6b4d31765dc11957dc0dd706c80ef5b0a21f9a7ce3b69f24ad1adff69d5e85fe52aae65d0ce3f76fc910c39a5dfb437f8bbc80d006cb06676c039bc8f8ae69caebf1041c04dc9a79c554aaf3cc9c2a42640127797b9f7b4492037e5e960548f9d637f2b872106379930cda8f332f9436f2a01b0da15b19b82193e63fb99311cac5f7e0bb13d07d7a7c8f3be50eb703adf6b68dac574af7639c5e9158cfdf420df4fe9e6c78b323f4c4fa6ff5449fcc07d0896f93955aaabe8d1363ca281030a0abb4e6951b922e1dfba92ff793fa0ac7ef191cda9ac808733ee71e51c9531ccc1071415a93853b2f0d4cef4cba101bcc6fc4a04ce5993e5a8920c28ed47a2d3cc318b8e1e441d8f020de62e8e972b0dc8f14c46caa900500ad24cebf0c55c39b2607492c8a61fce0c25c3bfb4b0991ff8d6cd07b0e870fd0ba7fc3cca4c5a56f875f022a2e61158e45a2809f6e0020dd57a84e675afe7b1072a33840411e8e87a1029fb341376aac4c1902abaad1161cc55e3e1298e0471bccdf92760aea8681d36f64fc27b4198f032fab8b0f21fd247af9a85d0acd98a7e5973de0709fdb78c67e2a71abf542d8d944bc1e5c3e8e6846a175e44b6563d8dcee84cb9903b89880951d3c1e19d9b82e5dacb1279b60e8fec88aa8591553905bb1b12614ad0f1d17e4c8c587fed9f570c9f9bbe14e19878503cdfa3b658eb88cecc44af58c4be17c34d744228360f2cd8d1046916a1d1bff2d2bdf0f1aabc2edb65bd4d56f5bfc34e55dede9b34d973970f759e95d3e8026ff1839951ac06ef8ff6d83796d994f95c2d5ffb124285f729f83086a7db58a6cb49bdbe555dead50d2d1c577a373c73bed66536efd841373c7e70521f05a13f2d605ffebd0a20845ce0a79fe210088f59bc4df5278f7261e2490425487310c5b34b7a3724433fe1164b238f0092c2932679fb1b6f310259e5a66cfa5a9bde1468ddea8c1e488163974461fbae11c2c6eaaf21e6071b4aafc0742c64c59dc16f54d03aa683643a4d8ecbb4a087600fba6469343016df813c36b9f3e544340d3bfe746b26beb00aae763f20a8198f036ce4cdc101720b76fb856d80f5b7d19bed1aeb5758694bf7bb0c46bdfbdf238c722d42d5dd04853485231b0cb8f47011cffcf44a27b883a44e3b6f07c7fda4b1f12c49a955b92cd439c47ab4ca52efcc75d5c4ac81d8224ca632177319c3b07b86aa10b070867e65304a2bf01b19470072e261db91344175f0f6b89ffea4d51f0de7e1dace1320e2623467e42d0ff5e6065affbdb152a970fa723dadb913805a907625bca80fb254a21e4ea60b725afaa4642193f220ac69bb1f8d9a94b02156fc3b9258678b195ab71bec7b0c0835fc5a958a112b73c339e792370a8475ceac76727152f3f6537782f21566e01c1f28c8a2a8fd083766218a6da999dd01f1ffd1c9842de68312ef8c2c2ce937886c1bf2cff50550663d6668f66d658395fb7ab9cd8a56fae509a30b71f3d61dd9353a3606d25c39347390331ce274ccd460d3b15214ddfc93bc09ff156a42cf83a0490a3cae7a360155173106a5faf560d2f78f8cb93361c564e92a4c2604c0cea077a8989297c86eb081963fcafecdd0b9cf987d0683d984ac8a4e745f84903f1f65c724c4d9f787cb96f3353f751b130e58e34800823154679e3da38e137c43d2c8e66173f3e5912ecd3c60ddcff49872d6cc9b3ff97b79debb0d77d1ff42aa3e297adbdc03c7d36b36832b3ad9def1382f10511e39d3c12f3587da2ffc869a19b40e4fb94faad12275c4ebe910dd1d0321a050314108ca78d9c5ef'

        AZURE_CLIENT_ID = '27158a34-4c57-4be0-8d3e-0a021b06cff2'
        AZURE_TENANT_ID = 'c46e1a6c-b262-4853-ab18-8b103d1702a9'

        # Sinchana Chat
        TEAMS_CHAT_ID = '19:575a63f0-bebb-4bbb-a8aa-72e478c2051d_f168194a-0d61-46ca-be2e-c4e75ff9b8be@unq.gbl.spaces'
        TEAMS_GROUP_ID = '19:DkOoz9LRk_DIHO7QkmC_4Tr_1rF-cPf_OQFK7zF5L_s1@thread.tacv2'
        TEAMS_TEAM_ID = '97b3591f-675a-49da-a4af-caec07ef0c5b'
        TEAMS_CHANNEL_ID = '19:DkOoz9LRk_DIHO7QkmC_4Tr_1rF-cPf_OQFK7zF5L_s1@thread.tacv2'

        # DB
        DB_HOST = 'localhost'
        DB_PORT = '5433'
        DB_DATABASE_NAME_ENCRYPTED = '94113b79d892ce95f0151adf8c4d4ef3:618656f56ada430cb3b65c348cd7811f'
        DB_USER = 'postgres'
        DB_PASSWORD_ENCRYPTED = 'f3620cbdd394e921664526aa62900035:57f5f31900a54b9660f930e3581c20ff'
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main', url: 'git@github.com:maaz-hgl/playwright-hris.git'
            }
        }

        stage('Install Dependencies') {
            steps {
                sh 'npm ci'
            }
        }

        stage('Run Playwright Tests') {
            steps {
                sh 'npx playwright test'
            }
        }

        stage('Generate Allure Report') {
            steps {
                sh 'npx allure generate allure-results --clean -o allure-report'
            }
        }

        stage('Publish Allure Report') {
            steps {
                allure includeProperties: false, jdk: '', results: [[path: 'allure-results']]
            }
        }
    }

    post {
        always {
            echo "Build finished: ${env.BUILD_URL}"
        }
        failure {
            echo "Build failed, check secrets & environment variables!"
        }
    }
}
